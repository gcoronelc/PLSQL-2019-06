
CREATE OR REPLACE VIEW SCOTT.V_EMPLEADOS AS 
SELECT E.EMPNO, E.ENAME, D.DEPTNO, D.DNAME 
FROM  SCOTT.EMP E INNER JOIN SCOTT.DEPT D 
ON E.DEPTNO = D.DEPTNO; 


SELECT * FROM SCOTT.V_EMPLEADOS;


CREATE OR REPLACE TRIGGER SCOTT.TR_VISTA 
INSTEAD OF INSERT OR DELETE ON SCOTT.V_EMPLEADOS   
FOR EACH ROW 
DECLARE 
  CUENTA NUMBER; 
BEGIN 
  IF INSERTING THEN 
  
    SELECT COUNT(*) INTO CUENTA FROM SCOTT.DEPT WHERE DEPTNO = :NEW.DEPTNO; 
    IF CUENTA = 0 THEN 
       INSERT INTO SCOTT.DEPT(DEPTNO,DNAME) 
       VALUES(:NEW.DEPTNO, :NEW.DNAME); 
    END IF; 
 
    SELECT COUNT(*) INTO CUENTA FROM SCOTT.EMP WHERE EMPNO = :NEW.EMPNO; 
    IF CUENTA = 0 THEN 
       INSERT INTO EMP(EMPNO,ENAME,DEPTNO) 
       VALUES(:NEW.EMPNO, :NEW.ENAME, :NEW.DEPTNO); 
    END IF;
      
  ELSIF DELETING THEN 
  
    DELETE FROM SCOTT.EMP WHERE EMPNO = :OLD.EMPNO; 
    
  END IF; 
END TR_VISTA; 
/



SELECT * FROM SCOTT.DEPT;

SELECT * FROM SCOTT.EMP;

SELECT * FROM SCOTT.V_EMPLEADOS;

INSERT INTO SCOTT.V_EMPLEADOS
VALUES( 9191,'KARLA',50,'IMPORTANTES' );

